# markdown 解析器

将markdown文件解析为类似dom树的结构。

## 支持的markdown语法

- 行级标签
  1. 标题 `# ##...`
  2. 有序与无序列表 `1. 2.  - * + ... `
  3. 区块 `>`
  4. 代码块 ```
  5. 分割线 `***, ---`

- 行内标签
  1. 代码段 ``
  2. 粗体 `**s**`
  3. 斜体 `*s*`
  4. 删除线 `~~s~~`
  5. 链接
  6. 图片

## 实现
实现分为行内标签和行级标签两部分，行内标签为粗体斜体之类的只会出现在某一行内的标签，行级标签为标题等包括一行的标签。

### 行内标签处理

首先，按照标记个数，行内标签可以分为二标记和三标记两种，其中二标记的包括粗体、斜体、删除线和代码段，三标记的包括链接和图片。之所以按照标记个数分类，是因为可以抽象出能够处理所有行内标签的结构。

将每种标签当做状态，待处理字符串text，其所具有的行为及属性如下
- 行为
  - 初始位于0节点
  - 确定是否能够进入下一阶段
  - 进入下一阶段，若为最后节点，触发状态完成监听器
  - 清空状态
- 属性
  - 阶段标记列表 - 每个节点的标记
  - 状态完成监听器
  - 下一阶段检查器 - 确定是否能够进入下一阶段，默认为 [当前位于第i节点并且text以第i+1节点标记开头]

解析text时具体流程如下:
```
begin
    初始化所有状态
    设置每个状态的阶段标记，如粗体为{'**', '**'}，链接为{'![', '](', ')'}
    设置状态的下一阶段检查器
        斜体只有在 text[i] = '*' and text[i+1] != '*' 的时候才进入下一阶段
        其余默认
    设置所有状态的状态完成监听器
        粗体斜体删除线
            创建新节点，添加到结果集
            清除起始位置≥当前状态起始位置，并且处于非0检查点的状态
            清除当前状态
        代码段、图片、链接
            创建新节点，添加到结果集
            清除起始位置≥当前状态起始位置，并且处于非0检查点的状态
            删除结果集中，起始位置≥当前状态的节点
            清除当前状态
    对于text，从0->text.size
        对于每个状态，若可以进入下一阶段
            进入下一阶段
```

## 已知bug

1. 行内标签能够处理的字符串大小为2GB
2. 对于形如`![xxxxxx](x![xxx](xxxx![xxxxxx)`的奇葩标签，不会就近匹配
   

## ~~预研~~

### ~~标题处理~~

```
创建根节点root
当前啊根节点 s = root
当前处理节点 p
如果为#
    读取至多5个#
    若下一个为空格
        读取所有空格 制表符
        若遇到回车 换行
            创建正文节点，将读取到的内容添加到p
        否则
            若p不为空，将p加入到s中
            p=创建标题节点
            读取到回车 换行
            若s为标题节点且s标题等级小于大于当前 
                s = s->parent 
            循环
            将p加入到s的子集中
            p置为空
    否则-不为空格
        继续读取到回车换行
        将读取到的内容添加到p
如果不为#
    读取到回车换行
    将读取到的内容添加到p

```
